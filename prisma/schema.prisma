// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

enum Role {
    customer 
    owner
}

enum Status {
    confirmed 
    cancelled 
}

model User {
    id        String   @id @db.VarChar(30)
    name      String
    email     String   @unique
    password  String
    role      Role
    phone     String
    createdAt DateTime @default(now()) @map("created_at")

    hotels   Hotel[]
    bookings Booking[]
    reviews  Review[]

    @@map("users")
}

model Hotel {
    id           String   @id @db.VarChar(30)
    ownerId      String      @map("owner_id")
    name         String
    description  String?
    city         String
    country      String
    amenities    String[] @default([])
    rating       Float  @default(0)
    totalReviews Int      @default(0) @map("total_reviews")
    createdAt    DateTime @default(now()) @map("created_at")

    owner    User      @relation(fields: [ownerId], references: [id])
    rooms    Room[]
    bookings Booking[]

    reviews Review[]

    @@map("hotels")
}

model Room {
    id            String   @id @db.VarChar(30)
    hotelId       String      @map("hotel_id")
    roomNumber    String   @map("room_number")
    roomType      String   @map("room_type")
    pricePerNight Decimal  @map("price_per_night")
    maxOccupancy  Int      @map("max_occupancy")
    createdAt     DateTime @default(now()) @map("created_at")

    hotel    Hotel     @relation(fields: [hotelId], references: [id])
    bookings Booking[]

    @@map("rooms")
}

model Booking {
    id      String   @id @db.VarChar(30)
    userId  String @map("user_id")
    roomId  String @map("room_id")
    hotelId String @map("hotel_id")

    checkInDate  DateTime @map("check_in_date")
    checkOutDate DateTime @map("check_out_date")

    guests     Int
    totalPrice Decimal @map("total_price") @db.Decimal(10, 2)

    status      Status    @default(confirmed)
    bookingDate DateTime  @default(now()) @map("booking_date")
    cancelledAt DateTime? @map("cancelled_at")

    user  User  @relation(fields: [userId], references: [id])
    room  Room  @relation(fields: [roomId], references: [id])
    hotel Hotel @relation(fields: [hotelId], references: [id])

    reviews Review[]

    @@map("bookings")
}

model Review {
    id        String   @id @db.VarChar(30)
    userId    String      @map("user_id")
    hotelId   String      @map("hotel_id")
    bookingId String      @unique @map("booking_id")

    rating    Int
    comment   String?
    createdAt DateTime @default(now()) @map("created_at")

    user    User    @relation(fields: [userId], references: [id])
    hotel   Hotel   @relation(fields: [hotelId], references: [id])
    booking Booking @relation(fields: [bookingId], references: [id])

    @@map("reviews")
}
